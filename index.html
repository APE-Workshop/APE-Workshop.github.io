<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>APE Workshop 소개</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #fefefe;
      color: #333;
      padding: 40px 20px;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .description {
      font-size: 1em;
      color: #555;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .links {
      margin-bottom: 30px;
    }

    .links a {
      display: inline-block;
      margin: 8px 12px;
      padding: 10px 16px;
      border-radius: 8px;
      background: #f1f1f1;
      text-decoration: none;
      color: #333;
      font-weight: bold;
    }

    .review-wrapper {
      position: relative;
      max-width: 700px;
      margin: 0 auto 30px auto;
    }

    .review-card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      padding: 25px;
      text-align: left;
    }

    .review-header {
      margin-bottom: 10px;
    }

    .camp-name {
      font-size: 1.2em;
      font-weight: bold;
    }

    .meta {
      font-size: 0.9em;
      color: gray;
    }

    .stars {
      color: gold;
      font-size: 20px;
      margin: 10px 0;
    }

    .section-title {
      font-weight: bold;
      margin-top: 15px;
    }

    .review-text {
      margin-top: 5px;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    .review-image {
      margin-top: 15px;
      max-width: 100%;
      max-height: 300px;
      border-radius: 10px;
      object-fit: contain;
    }

    .nav-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: #eee;
      border: none;
      font-size: 1.5em;
      padding: 10px;
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .nav-button:hover {
      background: #ccc;
    }

    .nav-left {
      left: -40px;
    }

    .nav-right {
      right: -40px;
    }

    .view-all-btn {
      margin-top: 20px;
      padding: 12px 24px;
      background: #333;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    .view-all-btn:hover {
      background: #111;
    }

    @media (max-width: 600px) {
      .nav-left, .nav-right {
        top: auto;
        bottom: -40px;
        left: 25%;
        right: auto;
        transform: none;
      }

      .nav-right {
        left: auto;
        right: 25%;
      }

      .links a {
        display: block;
        margin: 10px auto;
        width: 80%;
      }
    }
  </style>
</head>
<body>

  <h1>🛠️ APE Workshop</h1>
  <p class="description">
    APE Workshop은 Artists, Producers, Engineers가 모여<br>
    아이디어를 실험하고 함께 배우는 핸즈온 크리에이티브 네트워크입니다.
  </p>

  <div class="links">
    <a href="https://instagram.com/ape.workshop" target="_blank">📷 Instagram</a>
    <a href="https://cafe.naver.com/apeworkshop" target="_blank">☕ 네이버 카페</a>
    <a href="https://open.kakao.com/o/gApeworkshop" target="_blank">💬 오픈채팅</a>
  </div>

  <div class="review-wrapper">
    <button class="nav-button nav-left" onclick="prevReview()">←</button>
    <div id="review" class="review-card">리뷰 로딩 중...</div>
    <button class="nav-button nav-right" onclick="nextReview()">→</button>
  </div>

  <button class="view-all-btn" onclick="location.href='review.html'">📄 리뷰 전체 보기</button>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycby4lo9rjCqbSYRSNHtXIoYCgry9fkdFyKr-wz2OxdSR1RwQrp6ys34wrgnNbNLaC5Pv/exec?mode=review"; // ← 실제 URL로 교체
    let reviews = [];
    let currentIndex = 0;

    function getStars(rating) {
      return '⭐'.repeat(rating) + '☆'.repeat(5 - rating);
    }

    function formatRelativeTime(utcString) {
      const now = new Date();
      const kstDate = new Date(new Date(utcString).getTime() + (9 * 60 * 60 * 1000));
      const diffSec = Math.floor((now - kstDate) / 1000);
      const diffMin = Math.floor(diffSec / 60);
      const diffHr = Math.floor(diffMin / 60);
      const diffDay = Math.floor(diffHr / 24);

      if (diffSec < 60) return `${diffSec}초 전`;
      else if (diffMin < 60) return `${diffMin}분 전`;
      else if (diffHr < 24) return `${diffHr}시간 전`;
      else if (diffDay === 1) return `하루 전`;
      else return `${kstDate.getFullYear()}.${String(kstDate.getMonth() + 1).padStart(2, '0')}.${String(kstDate.getDate()).padStart(2, '0')}`;
    }

    function renderReview(r) {
      const name = r["이름"]?.trim() || "익명";
      const good = r["좋았던점"]?.trim();
      const bad = r["개선점"]?.trim();
      const image = r["이미지"]?.startsWith("data:image");

      document.getElementById("review").innerHTML = `
        <div class="review-header">
          <div class="camp-name">${r["캠프명"]}</div>
          <div class="meta">🕒 ${formatRelativeTime(r["제출일"])} · 👤 ${name}</div>
        </div>
        <div class="stars">${getStars(parseInt(r["만족도"]))}</div>

        ${good ? `<div class="section-title">✨ 좋았던 점</div><div class="review-text">${good}</div>` : ''}
        ${bad ? `<div class="section-title">🛠️ 개선점</div><div class="review-text">${bad}</div>` : ''}
        ${image ? `<img class="review-image" src="${r["이미지"]}" alt="리뷰 이미지">` : ''}
      `;
    }

    function showReview(index) {
      if (reviews.length === 0) return;
      currentIndex = (index + reviews.length) % reviews.length;
      renderReview(reviews[currentIndex]);
    }

    function prevReview() {
      showReview(currentIndex - 1);
    }

    function nextReview() {
      showReview(currentIndex + 1);
    }

    async function loadReviews() {
      try {
        const res = await fetch(API_URL);
        reviews = await res.json();
        if (reviews.length > 0) {
          showReview(0);
        } else {
          document.getElementById("review").innerHTML = "<p>리뷰가 없습니다.</p>";
        }
      } catch (e) {
        document.getElementById("review").innerHTML = "<p>리뷰를 불러올 수 없습니다.</p>";
        console.error(e);
      }
    }

    window.onload = loadReviews;
  </script>

</body>
</html>
